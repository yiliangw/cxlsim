#cloud-config
ssh_pwauth: true
disable_root: false 
users:
  - name: root
    lock_passwd: false
    plain_text_passwd: root
bootcmd:
  - systemctl mask systemd-networkd-wait-online || true # Do not wait for the network during boot
  - systemctl mask NetworkManager-wait-online.service || true
  - systemctl set-default multi-user.target # Disable graphical interface
runcmd:
  - sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config  # Allow root login with key or password
  - sed -i 's/^#\?PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config  # Enable password auth
  - sed -i 's/^#\?UsePAM.*/UsePAM no/' /etc/ssh/sshd_config # Disable PAM for speeding up
  - sed -i 's|^#\?HostKey /etc/ssh/ssh_host_rsa_key.*|HostKey /etc/ssh/ssh_host_rsa_key|' /etc/ssh/sshd_config # Use RSA
  - systemctl restart ssh  # Restart SSH to apply the changes
